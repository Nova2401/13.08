## EORA RAG Chat (Telegram + CLI)

Сервис на Python для ответов на вопросы клиентов на основе материалов EORA (RAG, OpenAI). Поддерживает Telegram-бота и CLI.

### Возможности
- Скрейпинг списка кейсов с `eora.ru` (см. `data/sources.txt`).
- Индексация: разбиение на чанки и эмбеддинги (OpenAI `text-embedding-3-small`).
- Поиск релевантных фрагментов и генерация ответа LLM (`gpt-4o-mini`).
- Ответ всегда на русском, с явным списком использованных источников (ссылки).
- Интерфейсы: Telegram-бот и CLI.

### Быстрый старт
1) Установите зависимости
```bash
pip install -r requirements.txt
```

2) Настройте переменные окружения
- Создайте `.env` рядом с проектом и укажите ключи:
  - `OPENAI_API_KEY`
  - `TELEGRAM_BOT_TOKEN` (если нужен бот)
  - можно оставить значения по умолчанию для `OPENAI_CHAT_MODEL`, `OPENAI_EMBED_MODEL`

3) Соберите индекс (скачает страницы, создаст эмбеддинги)
```bash
python -m app.ingest
```

4a) Задайте вопрос из CLI 
```bash
python -m app.cli "Что вы можете сделать для ритейлеров?"
```

4b) Запустите Telegram-бота
```bash
python -m app.bot
```

### Проверка примеров из задания
- Вопрос: «Что вы можете сделать для ритейлеров?»
- Ответ: «Например, мы делали бота для HR для Магнита, а ещё поиск по картинкам для KazanExpress»
  - Должны появиться ссылки на:
    - Магнит HR-бот: `https://eora.ru/cases/chat-boty/hr-bot-dlya-magnit-kotoriy-priglashaet-na-sobesedovanie`
    - КазанЭкспресс поиск по фото: `https://eora.ru/cases/kazanexpress-poisk-tovarov-po-foto`

### Описание (что сделали / оценка качества)
- Что пробовали:
  - Реализован RAG: скрейпинг → разбиение текста → эмбеддинги → поиск по косинусной близости → генерация ответа.
  - Источники задаются в `data/sources.txt`.
- Что сработало:
  - Качественные ответы на вопросы о кейсах, с точными ссылками.
  - Простая файловая БД индекса (JSON + Numpy), без внешних сервисов.
- Что не очень:
  - Полнота скрейпа зависит от вёрстки страниц, возможны лишние/пропущенные блоки.
  - Требуется ключ OpenAI; без него сборка индекса невозможна.
- Как оценивали качество:
  - Проверка ответов по контрольным вопросам из задания и ручная валидация ссылок в "Источниках".
- Что бы добавили при большем времени:
  - FastAPI с веб-чатом и потоковой генерацией.
  - Логирование и A/B.
  - Доп. провайдеры LLM и векторные БД (FAISS, Qdrant, PgVector).

### Безопасность и качество кода
- Переменные окружения, таймауты и повторные попытки на сетевых запросах.
- Строгая инструкция модели использовать только предоставленный контекст.
- SOLID-структура: отдельные классы для скрейпа, сплиттера, эмбеддингов, индекса и генерации.

### Структура
- `app/` — код сервиса
- `data/sources.txt` — список ссылок для индексации
- `data/index.json`, `data/embeddings.npy` — индекс и эмбеддинги

